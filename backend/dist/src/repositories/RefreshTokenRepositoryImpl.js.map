{"version":3,"file":"RefreshTokenRepositoryImpl.js","sourceRoot":"","sources":["../../../src/repositories/RefreshTokenRepositoryImpl.ts"],"names":[],"mappings":";;;AACA,6DAA0D;AAG1D,MAAa,0BAA2B,SAAQ,uCAAwC;IACtF;;;;OAIG;IACH,KAAK,CAAC,QAAQ,CAAC,EAAU;QACvB,OAAO,MAAM,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;IACtE,CAAC;IAED;;;OAGG;IACH,KAAK,CAAC,OAAO;QACX,OAAO,MAAM,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,QAAQ,EAAE,CAAC;IACnD,CAAC;IAED;;;;OAIG;IACH,KAAK,CAAC,MAAM,CAAC,gBAAoF;QAC/F,OAAO,MAAM,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,MAAM,CAAC,EAAE,IAAI,EAAE,gBAAgB,EAAE,CAAC,CAAC;IAC3E,CAAC;IAED;;;;;OAKG;IACH,KAAK,CAAC,MAAM,CAAC,EAAU,EAAE,gBAAuC;QAC9D,IAAI,CAAC;YACH,OAAO,MAAM,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,MAAM,CAAC;gBAC3C,KAAK,EAAE,EAAE,EAAE,EAAE;gBACb,IAAI,EAAE,gBAAgB;aACvB,CAAC,CAAC;QACL,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,IAAI,CAAC;QACd,CAAC;IACH,CAAC;IAED;;;;OAIG;IACH,KAAK,CAAC,MAAM,CAAC,EAAU;QACrB,IAAI,CAAC;YACH,MAAM,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,MAAM,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;YACzD,OAAO,IAAI,CAAC;QACd,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,KAAK,CAAC;QACf,CAAC;IACH,CAAC;IAED;;;;OAIG;IACH,KAAK,CAAC,MAAM,CAAC,EAAU;QACrB,MAAM,YAAY,GAAG,MAAM,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;QAClF,OAAO,CAAC,CAAC,YAAY,CAAC;IACxB,CAAC;IAED;;;OAGG;IACH,KAAK,CAAC,eAAe;QACnB,OAAO,MAAM,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,QAAQ,CAAC,EAAE,KAAK,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,EAAE,CAAC,CAAC;IACjF,CAAC;IAED;;;;OAIG;IACH,KAAK,CAAC,YAAY,CAAC,MAAc;QAC/B,OAAO,MAAM,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,QAAQ,CAAC;YAC7C,KAAK,EAAE,EAAE,OAAO,EAAE,MAAM,EAAE;YAC1B,OAAO,EAAE,EAAE,SAAS,EAAE,KAAK,EAAE;SAC9B,CAAC,CAAC;IACL,CAAC;IAED;;;;OAIG;IACH,KAAK,CAAC,WAAW,CAAC,EAAU;QAC1B,IAAI,CAAC;YACH,OAAO,MAAM,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,MAAM,CAAC;gBAC3C,KAAK,EAAE,EAAE,EAAE,EAAE;gBACb,IAAI,EAAE,EAAE,SAAS,EAAE,IAAI,IAAI,EAAE,EAAE;aAChC,CAAC,CAAC;QACL,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,IAAI,CAAC;QACd,CAAC;IACH,CAAC;IAED;;;OAGG;IACH,KAAK,CAAC,gBAAgB;QACpB,OAAO,MAAM,IAAI,CAAC,eAAe,EAAE,CAAC;IACtC,CAAC;CACF;AA/GD,gEA+GC","sourcesContent":["import { RefreshToken } from \"@prisma/client\";\r\nimport { BaseRepositoryImpl } from \"./BaseRepositoryImpl\";\r\nimport { RefreshTokenRepository } from \"./RefreshTokenRepository\";\r\n\r\nexport class RefreshTokenRepositoryImpl extends BaseRepositoryImpl<RefreshToken, number> implements RefreshTokenRepository {\r\n  /**\r\n   * Find a refresh token by its ID\r\n   * @param id - The unique identifier of the refresh token\r\n   * @returns A promise that resolves to the refresh token or null if not found\r\n   */\r\n  async findById(id: number): Promise<RefreshToken | null> {\r\n    return await this.prisma.refreshToken.findUnique({ where: { id } });\r\n  }\r\n\r\n  /**\r\n   * Find all refresh tokens\r\n   * @returns A promise that resolves to an array of all refresh tokens\r\n   */\r\n  async findAll(): Promise<RefreshToken[]> {\r\n    return await this.prisma.refreshToken.findMany();\r\n  }\r\n\r\n  /**\r\n   * Create a new refresh token\r\n   * @param refreshTokenData - The refresh token data to create\r\n   * @returns A promise that resolves to the created refresh token\r\n   */\r\n  async create(refreshTokenData: Omit<RefreshToken, 'id' | 'createdat' | 'expiresat' | 'revokedat'>): Promise<RefreshToken> {\r\n    return await this.prisma.refreshToken.create({ data: refreshTokenData });\r\n  }\r\n\r\n  /**\r\n   * Update an existing refresh token\r\n   * @param id - The unique identifier of the refresh token to update\r\n   * @param refreshTokenData - The updated refresh token data\r\n   * @returns A promise that resolves to the updated refresh token or null if not found\r\n   */\r\n  async update(id: number, refreshTokenData: Partial<RefreshToken>): Promise<RefreshToken | null> {\r\n    try {\r\n      return await this.prisma.refreshToken.update({\r\n        where: { id },\r\n        data: refreshTokenData\r\n      });\r\n    } catch (error) {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete a refresh token by its ID\r\n   * @param id - The unique identifier of the refresh token to delete\r\n   * @returns A promise that resolves to true if deletion was successful, false otherwise\r\n   */\r\n  async delete(id: number): Promise<boolean> {\r\n    try {\r\n      await this.prisma.refreshToken.delete({ where: { id } });\r\n      return true;\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if a refresh token exists by its ID\r\n   * @param id - The unique identifier to check\r\n   * @returns A promise that resolves to true if the refresh token exists, false otherwise\r\n   */\r\n  async exists(id: number): Promise<boolean> {\r\n    const refreshToken = await this.prisma.refreshToken.findUnique({ where: { id } });\r\n    return !!refreshToken;\r\n  }\r\n\r\n  /**\r\n   * Find all valid (non-revoked) refresh tokens\r\n   * @returns A promise that resolves to an array of valid refresh tokens\r\n   */\r\n  async findValidTokens(): Promise<RefreshToken[]> {\r\n    return await this.prisma.refreshToken.findMany({ where: { revokedat: null } });\r\n  }\r\n\r\n  /**\r\n   * Find refresh tokens by user ID\r\n   * @param userId - The ID of the user\r\n   * @returns A promise that resolves to an array of refresh tokens for the user\r\n   */\r\n  async findByUserId(userId: string): Promise<RefreshToken[]> {\r\n    return await this.prisma.refreshToken.findMany({ \r\n      where: { user_id: userId },\r\n      orderBy: { createdat: 'asc' }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Revoke a refresh token by setting its revoked timestamp\r\n   * @param id - The ID of the refresh token to revoke\r\n   * @returns A promise that resolves to the updated refresh token\r\n   */\r\n  async revokeToken(id: number): Promise<RefreshToken | null> {\r\n    try {\r\n      return await this.prisma.refreshToken.update({\r\n        where: { id },\r\n        data: { revokedat: new Date() }\r\n      });\r\n    } catch (error) {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Retrieves all valid (non-revoked) refresh tokens\r\n   * @returns A promise that resolves to an array of valid refresh tokens\r\n   */\r\n  async getRefreshTokens(): Promise<RefreshToken[]> {\r\n    return await this.findValidTokens();\r\n  }\r\n}"]}